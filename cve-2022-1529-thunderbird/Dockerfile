FROM centos:8

# Set mirror list or dnf will fail
RUN \
    sed -i "s/mirrorlist/#mirrorlist/g" /etc/yum.repos.d/CentOS-* && \
    sed -i "s|#baseurl=http://mirror.centos.org|baseurl=http://vault.centos.org|g" /etc/yum.repos.d/CentOS-* && \
    dnf update -y && \
    dnf install -y wget && \
    dnf clean all

# Copy all split files from the solr_files directory
COPY cve-2022-1529-thunderbird/thunderbird_files/* /tmp/thunderbird_files/

# Merge and extract the files
RUN cat /tmp/thunderbird_files/thunderbird_split* > /tmp/thunderbird-91.8.0-1.amzn2.0.1.x86_64.rpm

# Install Thunderbird
RUN dnf localinstall -y /tmp/thunderbird-91.8.0-1.amzn2.0.1.x86_64.rpm && \
    rm /tmp/thunderbird-91.8.0-1.amzn2.0.1.x86_64.rpm